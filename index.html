<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>ç«–å±åƒç´ ç»˜æœ¬</title>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/blasten/turn.js/turn.min.js"></script>
<style>
body {
  margin:0;
  background:#fefefe;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  overflow:hidden;
  font-family:sans-serif;
}

/* ç”µå­ä¹¦å®¹å™¨ */
#book {
  width:90vw;
  max-width:500px;
  aspect-ratio:9/16;
  box-shadow:0 0 20px rgba(0,0,0,0.3);
  background:#fff;
}
#book .page img {
  width:100%;
  height:100%;
  object-fit:contain;
  display:block;
}

/* ç¿»é¡µæŒ‰é’® */
button {
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  background:rgba(0,0,0,0.5);
  color:white;
  border:none;
  padding:12px 24px;
  font-size:20px;
  cursor:pointer;
  border-radius:6px;
  z-index:10;
  user-select:none;
}
#prev { left:20px; }
#next { right:20px; }

/* éŸ³ä¹æŒ‰é’®å›ºå®šå³ä¸Šè§’ */
#audio-control {
  position: fixed;
  top:10px;
  right:10px;
  background:rgba(0,0,0,0.5);
  color:white;
  padding:8px 16px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  z-index:20;
}

/* éŸ³ä¹æç¤ºæ–‡å­— */
#music-tip {
  position: fixed;
  top:50px;
  right:10px;
  background: rgba(0,0,0,0.6);
  color:white;
  padding:6px 12px;
  border-radius:6px;
  font-size:14px;
  z-index:20;
}
</style>
</head>
<body>

<!-- éŸ³ä¹ -->
<audio id="bgm" src="https://cdn.jsdelivr.net/gh/GG-Bony/our-first-anniversary@main/music.mp3" preload="auto" loop></audio>
<button id="audio-control">æ’­æ”¾éŸ³ä¹</button>
<div id="music-tip">ç‚¹å‡»æŒ‰é’®æ’­æ”¾éŸ³ä¹ ğŸµ</div>

<!-- ç¿»é¡µæŒ‰é’® -->
<button id="prev">â¬… ä¸Šä¸€é¡µ</button>
<button id="next">ä¸‹ä¸€é¡µ â¡</button>

<!-- ç”µå­ä¹¦å®¹å™¨ -->
<div id="book">
  <div class="page"><img src="https://cdn.jsdelivr.net/gh/gg-bony/our-first-anniversary@main/ç¬¬ä¸€ä¸ª.jpg"></div>
  <div class="page"><img src="https://cdn.jsdelivr.net/gh/gg-bony/our-first-anniversary@main/ç¬¬äºŒä¸ª.jpg"></div>
  <div class="page"><img src="https://cdn.jsdelivr.net/gh/gg-bony/our-first-anniversary@main/ç¬¬ä¸‰ä¸ª.jpg"></div>
  <div class="page"><img src="https://cdn.jsdelivr.net/gh/gg-bony/our-first-anniversary@main/ç¬¬å››ä¸ª.jpg"></div>
  <div class="page"><img src="https://cdn.jsdelivr.net/gh/gg-bony/our-first-anniversary@main/ç¬¬äº”ä¸ª.jpg"></div>
  <div class="page"><img src="https://cdn.jsdelivr.net/gh/gg-bony/our-first-anniversary@main/ç¬¬å…­ä¸ª.jpg"></div>
  <div class="page"><img src="https://cdn.jsdelivr.net/gh/gg-bony/our-first-anniversary@main/ç¬¬ä¸ƒä¸ª.jpg"></div>
  <div class="page"><img src="https://cdn.jsdelivr.net/gh/gg-bony/our-first-anniversary@main/ç¬¬å…«ä¸ª.jpg"></div>
  <div class="page"><img src="https://cdn.jsdelivr.net/gh/gg-bony/our-first-anniversary@main/ç¬¬ä¹ä¸ª.jpg"></div>
  <div class="page"><img src="https://cdn.jsdelivr.net/gh/gg-bony/our-first-anniversary@main/ç¬¬åä¸ª.jpg"></div>
  <div class="page"><img src="https://cdn.jsdelivr.net/gh/gg-bony/our-first-anniversary@main/ç¬¬åä¸€ä¸ª.jpg"></div>
  <div class="page"><img src="https://cdn.jsdelivr.net/gh/gg-bony/our-first-anniversary@main/ç¬¬åäºŒä¸ª.jpg"></div>
  <div class="page"><img src="https://cdn.jsdelivr.net/gh/gg-bony/our-first-anniversary@main/ç¬¬åä¸‰ä¸ª.jpg"></div>
  <div class="page"><img src="https://cdn.jsdelivr.net/gh/gg-bony/our-first-anniversary@main/ç¬¬åå››ä¸ª.jpg"></div>
  <div class="page"><img src="https://cdn.jsdelivr.net/gh/gg-bony/our-first-anniversary@main/ç¬¬åäº”ä¸ª.jpg"></div>
  <div class="page"><img src="https://cdn.jsdelivr.net/gh/gg-bony/our-first-anniversary@main/ç¬¬åå…­ä¸ª.jpg"></div>
  <div class="page"><img src="https://cdn.jsdelivr.net/gh/gg-bony/our-first-anniversary@main/ç¬¬åä¸ƒä¸ª.jpg"></div>
  <div class="page"><img src="https://cdn.jsdelivr.net/gh/gg-bony/our-first-anniversary@main/ç¬¬åå…«ä¸ª.jpg"></div>
  <div class="page"><img src="https://cdn.jsdelivr.net/gh/gg-bony/our-first-anniversary@main/ç¬¬åä¹ä¸ª.jpg"></div>
  <div class="page"><img src="https://cdn.jsdelivr.net/gh/gg-bony/our-first-anniversary@main/ç¬¬äºŒåä¸ª.jpg"></div>
</div>

<script>
$(function(){
  const $book = $("#book");
  const bgm = document.getElementById('bgm');
  const $musicTip = $("#music-tip");

  // ç­‰å¾…æ‰€æœ‰å›¾ç‰‡åŠ è½½å®Œæˆ
  const images = $book.find("img");
  let loaded = 0;
  images.each(function(){
    $(this).on('load', function(){
      loaded++;
      if(loaded === images.length){
        initBook();
      }
    }).each(function(){ if(this.complete) $(this).trigger('load'); });
  });

  function initBook(){
    const bookWidth = $book.width();
    const bookHeight = Math.round(bookWidth * 16 / 9); // ç«–å± 9:16

    $book.turn({
      width: bookWidth,
      height: bookHeight,
      autoCenter: true,
      duration: 600,
      display: "single"
    });

    // ç¿»é¡µæŒ‰é’®
    $("#next").off('click').on('click', ()=> $book.turn("next"));
    $("#prev").off('click').on('click', ()=> $book.turn("previous"));

    // é”®ç›˜ç¿»é¡µ
    $(document).off('keydown').on('keydown', function(e){
      if(e.key === "ArrowRight") $book.turn("next");
      if(e.key === "ArrowLeft") $book.turn("previous");
    });

    // éŸ³ä¹æ§åˆ¶ï¼Œåªè§¦å‘ä¸€æ¬¡
    $("#audio-control").one('click', async function(){
      try {
        await bgm.play();
        $(this).text("æš‚åœéŸ³ä¹");
        $musicTip.fadeOut(500);
      } catch(err){
        console.log("æ’­æ”¾å¤±è´¥:", err);
        alert("æµè§ˆå™¨é˜»æ­¢äº†æ’­æ”¾ï¼Œè¯·å†æ¬¡ç‚¹å‡»æ’­æ”¾æŒ‰é’®");
      }

      // åˆ‡æ¢æš‚åœ/æ’­æ”¾
      $(this).off('click').on('click', async function(){
        if(bgm.paused){
          await bgm.play();
          $(this).text("æš‚åœéŸ³ä¹");
        } else {
          bgm.pause();
          $(this).text("æ’­æ”¾éŸ³ä¹");
        }
      });
    });

    // çª—å£ç¼©æ”¾æ—¶æ›´æ–° Turn.js å°ºå¯¸
    $(window).on('resize', function(){
      const newWidth = $book.width();
      const newHeight = Math.round(newWidth * 16 / 9);
      $book.turn("size", newWidth, newHeight);
    });
  }
});
</script>

</body>
</html>
